@model IEnumerable<Knowledgeable.Models.CommentModel>

<style>
    .Subcomment
    {
        margin-left: 20px;
    }

    .comment
    {
        background-color:gray;
        border-radius:10px;
        padding-bottom:8px;
        padding-top:10px;
        padding-right:5px;
        padding-left:5px;
        margin-bottom:10px;
    }

    .Subcomment
    {
        background-color:lightgray;
        border-radius:10px;
        padding-bottom:5px;
        padding-top:5px;
        padding-right:15px;
        padding-left:5px;
        margin-bottom:10px;
    }

    .vote
    {
        color:blue;
        cursor:pointer;
    }

    .vote:hover
    {
        color:blue;
        text-decoration:underline;
        cursor:pointer;
    }

    .vote:active
    {
        color:red;
        cursor:pointer;
    }
</style>

<h3>Comments</h3>



@foreach (var item in Model)
{
    <div id="comment" class="comment">
        <p style="font-weight:bold;">@item.UserID</p>

        <p>@item.Comment1</p>

        <p>@item.DatePosted | <span class="vote" onclick="UpvoteC('@item.CommentID')">Upvote: </span> @item.UpVote | <span class="vote" onclick="DownvoteC('@item.CommentID')">Downvote: </span> @item.DownVote </p>


        <div class="reply" id="reply">
            <textarea type="text" id="@item.CommentID" rows="3" cols="500" style="padding-top:2px; padding-left:4px; font-family:'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;" placeholder="Reply to this comment"></textarea>
            <br /><br />
            <input type="button" value="Reply" onclick="SubmitS_Comment('@item.CommentID')" class="btn btn-default" />
        </div>

        <hr />

        @foreach (var sub in item.listSubcomment)
        {
            if (sub != null)
            { 
                <div id="Subcomment" class="Subcomment">
                    <h3>@sub.UserID</h3>

                    <p>@sub.SubComment1</p>

                    <p>@sub.DatePosted | <span class="vote" onclick="UpvoteSC('@sub.SubCommentID')">Upvote: </span> @sub.UpVote | <span class="vote" onclick="DownvoteSC('@sub.SubCommentID')">Downvote: </span> @sub.DownVote </p>
                </div>
            }
        }
    </div>
}
<script src="~/Scripts/jquery-2.2.0.js"></script>
<script>

    function UpvoteC(id)
    {
        alert(id);
        $.ajax({
            type: "GET",
            url: '/Comment/UpvoteC',
            data: { id: id},
            processdata: true,
            cache: false,
            contentType: "application/html",
            dataType: "html",
            success: function (data) {
                if (data != "") {
                    alert(data);
                }
                else {
                    alert('Upvote Successful');
                    reload();
                }
            },
            error: function (xhr, status, error) {
                //alert(xhr.responseText);
                //var err = eval("(" + xhr.responseText + ")");
                alert("error");
            },
        });
    }

    function UpvoteSC(id)
    {
        alert(id);
        $.ajax({
            type: "GET",
            url: '/Comment/UpvoteSC',
            data: { id: id},
            processdata: true,
            cache: false,
            contentType: "application/html",
            dataType: "html",
            success: function (data) {
                if (data != "") {
                    alert(data);
                }
                else {
                    alert('Upvote Successful');
                    reload();
                }
            },
            error: function (xhr, status, error) {
                //alert(xhr.responseText);
                //var err = eval("(" + xhr.responseText + ")");
                alert("error");
            },
        });
    }

    function DownvoteC(id)
    {
        alert(id);
        $.ajax({
            type: "GET",
            url: '/Comment/DownvoteC',
            data: { id: id},
            processdata: true,
            cache: false,
            contentType: "application/html",
            dataType: "html",
            success: function (data) {
                if (data != "") {
                    alert(data);
                }
                else {
                    alert('Downvote Successful');
                    reload();
                }
            },
            error: function (xhr, status, error) {
                //alert(xhr.responseText);
                //var err = eval("(" + xhr.responseText + ")");
                alert("error");
            },
        });
    }

    function DownvoteSC(id)
    {
        alert(id);
        $.ajax({
            type: "GET",
            url: '/Comment/DownvoteSC',
            data: { id: id},
            processdata: true,
            cache: false,
            contentType: "application/html",
            dataType: "html",
            success: function (data) {
                if (data != "") {
                    alert(data);
                }
                else {
                    alert('Downvote Successful');
                    reload();
                }
            },
            error: function (xhr, status, error) {
                //alert(xhr.responseText);
                //var err = eval("(" + xhr.responseText + ")");
                alert("error");
            },
        });
    }

    function SubmitS_Comment(id) {
        alert(id);
        var comment = $('#' + id).val();
        SS_Comment(id, comment);
    }

    function SS_Comment(id, comment) {
        alert(id);
        alert(comment);
        $.ajax({
            type: "GET",
            url: '/Comment/SS_Comment',
            data: { id: id, comment: comment },
            processdata: true,
            cache: false,
            contentType: "application/html",
            dataType: "html",
            success: function (data) {
                if (data != "") {
                    alert(data);
                }
                else {
                    alert('Subcomment has been posted');
                    reload();
                }
            },
            error: function (xhr, status, error) {
                //alert(xhr.responseText);
                //var err = eval("(" + xhr.responseText + ")");
                alert("error");
            },
        });
    }

    function reload()
    {
        $.ajax({
            type: "GET",
            url: '/Comment/LoadComment',
            data: { id: articleid},
            processdata: true,
            cache: false,
            contentType: "application/html",
            dataType: "html",
            success: function (data) {
                //var JsonObj = $.parseJSON(data);
                $("#comment").html(data);
                document.getElementById('editButton').innerHTML = "Cancel";
                document.getElementById('titleTop').innerHTML = "Edit";

            },
            error: function (xhr, status, error) {
                //alert(xhr.responseText);
                //var err = eval("(" + xhr.responseText + ")");
                alert("error");
            },
        });
    }

</script>